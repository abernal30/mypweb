<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Rational agent and behavioral finance in investment | Algorithms and Financial Programming in R</title>
<meta name="author" content="Arturo Bernal">
<meta name="description" content="In this chapter we will use the following libraries: library(quantmod) library(lmtest) library(openxlsx) library(dplyr) Around 1970, economists argued that an efficient market should...">
<meta name="generator" content="bookdown 0.30 with bs4_book()">
<meta property="og:title" content="7 Rational agent and behavioral finance in investment | Algorithms and Financial Programming in R">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.arturo-bernal.com/book/rational-agent-and-behavioral-finance-in-investment.html">
<meta property="og:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<meta property="og:description" content="In this chapter we will use the following libraries: library(quantmod) library(lmtest) library(openxlsx) library(dplyr) Around 1970, economists argued that an efficient market should...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="7 Rational agent and behavioral finance in investment | Algorithms and Financial Programming in R">
<meta name="twitter:description" content="In this chapter we will use the following libraries: library(quantmod) library(lmtest) library(openxlsx) library(dplyr) Around 1970, economists argued that an efficient market should...">
<meta name="twitter:image" content="https://www.arturo-bernal.com/book/images/coverf.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Roboto-0.4.2/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.1/transition.js"></script><script src="libs/bs3compat-0.4.1/tabs.js"></script><script src="libs/bs3compat-0.4.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-68765210-2', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Algorithms and Financial Programming in R</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Algorithms and Financial Programming in R</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> R Basics</a></li>
<li><a class="" href="clean.html"><span class="header-section-number">2</span> Big data and data cleaning with datapro</a></li>
<li><a class="" href="graphs.html"><span class="header-section-number">3</span> APIS and R graphs</a></li>
<li><a class="" href="logit.html"><span class="header-section-number">4</span> Machine learning with market direction prediction: Logit</a></li>
<li><a class="" href="big-data-and-machine-learning.html"><span class="header-section-number">5</span> Big data and machine learning</a></li>
<li><a class="" href="credit-analysis.html"><span class="header-section-number">6</span> Credit analysis</a></li>
<li><a class="active" href="rational-agent-and-behavioral-finance-in-investment.html"><span class="header-section-number">7</span> Rational agent and behavioral finance in investment</a></li>
<li><a class="" href="applied-market-anomalies.-momentum-market-anomalies.html"><span class="header-section-number">8</span> Applied market anomalies. Momentum market anomalies</a></li>
<li><a class="" href="momentum-or-directional-trading.html"><span class="header-section-number">9</span> Momentum or directional trading</a></li>
<li><a class="" href="portfolio-management-algorithms.html"><span class="header-section-number">10</span> Portfolio management algorithms</a></li>
<li><a class="" href="references.html"><span class="header-section-number">11</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/abernal30/BookAFP">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="rational-agent-and-behavioral-finance-in-investment" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Rational agent and behavioral finance in investment<a class="anchor" aria-label="anchor" href="#rational-agent-and-behavioral-finance-in-investment"><i class="fas fa-link"></i></a>
</h1>
<p>In this chapter we will use the following libraries:</p>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.quantmod.com">quantmod</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ycphs.github.io/openxlsx/index.html">openxlsx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>Around 1970, economists argued that an efficient market should instantaneously reflect all the available information of a particular financial security, called the Efficient Market Hypothesis EMH <span class="citation">(<a href="references.html#ref-FAMA" role="doc-biblioref">Fama 1970</a>)</span>. Then, arbitrage opportunities were difficult to exist, or they used to argue that those markets needed to be more predictable. Academics were reasonably content with the EMH until in1987 stock market behavior in 1987 was bizarre. The year began with the Dow Jones Industrial Average’s historic collapse. What is interesting about 1987 is that trading folklore and the activities of leading academic economists fit the behavioral finance point of view, not the EMH point of view. Economists actively discussing and acting in financial markets seemed to believe that markets were predictable, a key principle of modern behavioral finance <span class="citation">(<a href="references.html#ref-BF" role="doc-biblioref">Burton and Shah 2013</a>)</span>.</p>
<p>By designing systematic trading platforms, some traders and trading systems aim to generate trading signals that consistently produce positive outcomes over many trades. Usually, the trades test successfully of trading systems on large amounts of past historical data. A more scientific method for analyzing a particular financial security may lie in determining whether the security price changes are random or not. If the price changes are random, the probability of detecting a consistently profitable trading opportunity for that particular security is small. On the other hand, if the price changes are nonrandom, the financial security has persistent predictability and should be analyzed further. Then, it is possible to measure the relative availability of trading opportunities with the market inefficiency tests <span class="citation">(<a href="references.html#ref-HFT" role="doc-biblioref">Aldridge 2010</a>)</span>. In summary, if the tests detect that new information takes in slowly in the asset prices, arbitrage opportunities exist, and the market is inefficient.</p>
<p>In this chapter, we apply a test proposed by <span class="citation">(<a href="references.html#ref-wooldridge" role="doc-biblioref">Wooldridge 2020</a>)</span> to identify arbitrage opportunities or to find inefficient markets.</p>
<div id="emh-test-on-historical-returns-for-one-asset" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> EMH test on historical returns for one asset<a class="anchor" aria-label="anchor" href="#emh-test-on-historical-returns-for-one-asset"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose <span class="math inline">\(y_{t}\)</span> is the daily price of the S&amp;P500. A strict form of the efficient markets hypothesis establishes that the historical information on the index before day <em>t</em> should not help predict the index. If we use only past information on <span class="math inline">\(y_{t}\)</span>, a market is efficient if the following is true:</p>
<p><span class="math display">\[y_t= \beta_0 +\beta_1\ y_{t-1} + \beta_2\ y_{t-2}+u_t\]</span></p>
<p>Where the term on the right is the expected value of <span class="math inline">\(y_{t}\)</span>, given the historical information of the index <span class="math inline">\(y_{t-1} ,y_{t-2},....\)</span>. In other words, the expected value does not depend on its own historical information. However, if the previous equation is false, it implies that we could use the information to predict the current price. If the previous equation is false, we could use the information on the past to predict the current price.</p>
<p>Suppose that we want to make the EMH test on the returns of the S&amp;P 500 index. In the next code, we download the S&amp;P 500 index from “2019-10-20” to “2022-10-20”. Remember that by yahoo finance, the ticker name is “^GSPC”.</p>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ticker</span><span class="op">&lt;-</span><span class="st">"^GSPC"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html">getSymbols</a></span><span class="op">(</span><span class="va">ticker</span>, from<span class="op">=</span><span class="st">"2019-10-20"</span>, to<span class="op">=</span><span class="st">"2022-10-20"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "^GSPC"</span></span></code></pre></div>
<p>We take the close price of the index, apply the function <em>Delt</em> to estimate the returns.</p>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">close</span><span class="op">&lt;-</span><span class="va">GSPC</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span></span>
<span><span class="va">ret</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/Delt.html">Delt</a></span><span class="op">(</span><span class="va">close</span><span class="op">)</span></span></code></pre></div>
<p><span class="math display">\[y_t= \beta_0 +\beta_1\ y_{t-1} + \beta_2\ y_{t-2}+u_t\]</span></p>
<p>To run the previous model, we need to create the variables and store them in a data frame. We apply the function <em>lag</em> to create the lagged variables-</p>
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lag1</span><span class="op">&lt;-</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">ret</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lag2</span><span class="op">&lt;-</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">ret</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ret</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">ret</span>, <span class="va">lag1</span>,<span class="va">lag2</span><span class="op">)</span></span></code></pre></div>
<p>For convenience, we change the column names.</p>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SP500"</span>,<span class="st">"SP500_lag1"</span>,<span class="st">"SP500_lag2"</span><span class="op">)</span></span></code></pre></div>
<p>We apply an OLS regression:</p>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SP500</span> <span class="op">~</span><span class="va">.</span>,data <span class="op">=</span><span class="va">ret</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; lm(formula = SP500 ~ ., data = ret)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residuals:</span></span>
<span><span class="co">#&gt;       Min        1Q    Median        3Q       Max </span></span>
<span><span class="co">#&gt; -0.111441 -0.005786  0.000537  0.007425  0.092978 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;               Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)  0.0004309  0.0005521   0.780 0.435371    </span></span>
<span><span class="co">#&gt; SP500_lag1  -0.1990963  0.0362312  -5.495 5.35e-08 ***</span></span>
<span><span class="co">#&gt; SP500_lag2   0.1248616  0.0362416   3.445 0.000602 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Residual standard error: 0.01514 on 750 degrees of freedom</span></span>
<span><span class="co">#&gt;   (3 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; Multiple R-squared:  0.06649,    Adjusted R-squared:  0.06401 </span></span>
<span><span class="co">#&gt; F-statistic: 26.71 on 2 and 750 DF,  p-value: 6.219e-12</span></span></code></pre></div>
<p>Remember, a significant beta1 coefficient would reject EMH.</p>
<p>For example, we could use past information on the price or a moving average to forecast the Biance price.</p>
<p><span class="math display">\[bnb_{t}=\alpha\ +\beta1\ bnb_{t-1}+\beta2\ bnb_{t-2} +\beta3\ sma +\ e\]</span></p>
</div>
<div id="emh-test-for-variance-for-one-asset" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> EMH test for variance for one asset<a class="anchor" aria-label="anchor" href="#emh-test-for-variance-for-one-asset"><i class="fas fa-link"></i></a>
</h2>
<p>For some financial time series, such as stock returns, the expected returns do not depend on past returns (the Market is efficient), but the variance of returns does. For example, in the model:</p>
<p><span class="math display">\[r_t= \beta_0 +\beta_1\ r_{t-1}+u_t\]</span></p>
<p>We could apply a test to verify if the variance of returns have an effect o the returns:</p>
<p><span class="math display">\[u^2_{t}= \delta_0 +\delta_1\ r_{t-1}+e_t\]</span></p>
<p>The previous model is heteroskedasticity test, then we could applya Breusch-Pagan test for heteroskedasticity, using the function bptest(model)</p>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">lmtest</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/bptest.html">bptest</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  studentized Breusch-Pagan test</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  model</span></span>
<span><span class="co">#&gt; BP = 27.216, df = 2, p-value = 1.23e-06</span></span></code></pre></div>
<p>Suppose the test is significant in the former result (p-value &lt;10%). Then there is no EMH, and we could use the variance or standard deviation to make a prediction.</p>
<p>For example, we could use past information and a standard deviation moving average, <span class="math inline">\(sdma\)</span>, to forecast the Biance price.</p>
<p><span class="math display">\[bnb_{t}=\alpha\ +\beta1\ bnb_{t-1}+\beta2\ bnb_{t-2} +\beta3\ sma +\beta4\ sdma +\ e\]</span></p>
<p>See chapter 5 of the book for an example. “Big data and machine learning”
<a href="https://www.arturo-bernal.com/book/AFP/big-data-and-machine-learning.html" class="uri">https://www.arturo-bernal.com/book/AFP/big-data-and-machine-learning.html</a></p>
<p>We show another example in the next section.</p>
</div>
<div id="emh-tests-for-the-variance-for-many-assets-to-build-a-portfolio" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> EMH tests for the variance for many assets to build a portfolio<a class="anchor" aria-label="anchor" href="#emh-tests-for-the-variance-for-many-assets-to-build-a-portfolio"><i class="fas fa-link"></i></a>
</h2>
<p>In the next session, we will cover the subject of market anomalies. We will cover the momentum anomalies. However, that strategy is for constructing a portfolio of stocks. However, first, we need to filter those stocks for which we can make a prediction. We filter for the variance test of efficient markets hypothesis.</p>
<p>First we read the data, and for convenience, we transform the data frame into xts.</p>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">df</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/read.xlsx.html">read.xlsx</a></span><span class="op">(</span><span class="st">"data/df_dates.xlsx"</span>, detectDates <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">date</span><span class="op">&lt;-</span><span class="va">df</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">datax</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>         order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We estimated the returns, Delt.
apply(data, 2, func)</p>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">return_all</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">datax</span>, <span class="fl">2</span>, <span class="va">Delt</span><span class="op">)</span></span></code></pre></div>
<p>Xts again: becasue we loos the xts property:</p>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">return_all_xts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span><span class="va">return_all</span>,</span>
<span>         order.by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">return_all_xts</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="co">#&gt;              AAPL.Close   MSFT.Close    GOOG.Close  GOOGL.Close</span></span>
<span><span class="co">#&gt; 2020-01-02           NA           NA            NA           NA</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.009722044 -0.012451750 -0.0049072022 -0.005231342</span></span>
<span><span class="co">#&gt; 2020-01-06  0.007968248  0.002584819  0.0246570974  0.026654062</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.004703042 -0.009117758 -0.0006240057 -0.001931646</span></span>
<span><span class="co">#&gt; 2020-01-08  0.016086289  0.015928379  0.0078803309  0.007117757</span></span>
<span><span class="co">#&gt; 2020-01-09  0.021240806  0.012492973  0.0110444988  0.010497921</span></span></code></pre></div>
<p>The following code has the same test we made for one stock on the previous second section of this chapter:</p>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">i</span><span class="op">&lt;-</span><span class="fl">1</span></span>
<span></span>
<span><span class="co">#For the next chunk:</span></span>
<span></span>
<span><span class="co">#---------------copy from here------- </span></span>
<span><span class="va">data</span><span class="op">&lt;-</span><span class="va">return_all_xts</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span><span class="va">lag1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">data</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lag2</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">data</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">lag1</span>,<span class="va">lag2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SP500"</span>,<span class="st">"SP500_lag1"</span>,<span class="st">"SP500_lag2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#-------------to here ------------</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SP500</span> <span class="op">~</span><span class="va">.</span>,data <span class="op">=</span><span class="va">ret</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/bptest.html">bptest</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">[[</span><span class="st">"p.value"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">bp</span></span>
<span><span class="co">#&gt;         BP </span></span>
<span><span class="co">#&gt; 0.00134487</span></span></code></pre></div>
<p>The next chunk shows a “Loop For” to show a similar procedure as the previous chunk. The knowledge it requires is over the level of this course’s contents. You could expect to develop the process for the final exam following the procedure of the previous chunk, building an R function together with the “apply” function, not creating a “Loop For.”</p>
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp_all_Loop</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dim</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">return_all_xts</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">dim</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span><span class="co">#----copy here -----</span></span>
<span></span>
<span>  <span class="va">data</span><span class="op">&lt;-</span><span class="va">return_all_xts</span><span class="op">[</span>, <span class="va">i</span><span class="op">]</span></span>
<span><span class="va">lag1</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">data</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lag2</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lag.html">lag</a></span><span class="op">(</span><span class="va">data</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">lag1</span>,<span class="va">lag2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SP500"</span>,<span class="st">"SP500_lag1"</span>,<span class="st">"SP500_lag2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ----to Here----------------</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">SP500</span> <span class="op">~</span><span class="va">.</span>,data <span class="op">=</span><span class="va">ret</span><span class="op">)</span></span>
<span>  <span class="va">bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/bptest.html">bptest</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span>  <span class="va">bp</span> <span class="op">&lt;-</span> <span class="va">bp</span><span class="op">[[</span><span class="st">"p.value"</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">bp_all_Loop</span><span class="op">[</span><span class="va">i</span>,<span class="fl">1</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">return_all_xts</span><span class="op">)</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">bp_all_Loop</span><span class="op">[</span><span class="va">i</span>,<span class="fl">2</span><span class="op">]</span><span class="op">&lt;-</span><span class="va">bp</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">bp_all_Loop</span><span class="op">)</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ticker"</span>,<span class="st">"p-value"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bp_all_Loop</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ticker     p-value</span></span>
<span><span class="co">#&gt; 1  AAPL.Close 0.001344870</span></span>
<span><span class="co">#&gt; 2  MSFT.Close 0.002359318</span></span>
<span><span class="co">#&gt; 3  GOOG.Close 0.007415325</span></span>
<span><span class="co">#&gt; 4 GOOGL.Close 0.009713821</span></span>
<span><span class="co">#&gt; 5  AMZN.Close 0.542408713</span></span>
<span><span class="co">#&gt; 6  TSLA.Close 0.086492404</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">bp_all_Loop</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Ticker      p-value</span></span>
<span><span class="co">#&gt; 95    TXN.Close 0.0002357208</span></span>
<span><span class="co">#&gt; 96    CRM.Close 0.8711756478</span></span>
<span><span class="co">#&gt; 97    BMY.Close 0.1610277136</span></span>
<span><span class="co">#&gt; 98    UPS.Close 0.9590241181</span></span>
<span><span class="co">#&gt; 99  RLLCF.Close 0.8083656314</span></span>
<span><span class="co">#&gt; 100  QCOM.Close 0.0539758548</span></span></code></pre></div>
<p>The following code helps us count the number of tickers we could use to make a prediction, applying the “ifelse” function and combing it with the object containing the EMH test.</p>
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">bp_all_Loop</span><span class="op">[</span>,<span class="st">"p-value"</span><span class="op">]</span><span class="op">&lt;</span><span class="fl">0.1</span>,<span class="st">"Predict"</span>,<span class="st">"No Predict"</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">bp_all_Loop_1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bp_all_Loop</span>,<span class="va">pred</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bp_all_Loop_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ticker     p-value       pred</span></span>
<span><span class="co">#&gt; 1  AAPL.Close 0.001344870    Predict</span></span>
<span><span class="co">#&gt; 2  MSFT.Close 0.002359318    Predict</span></span>
<span><span class="co">#&gt; 3  GOOG.Close 0.007415325    Predict</span></span>
<span><span class="co">#&gt; 4 GOOGL.Close 0.009713821    Predict</span></span>
<span><span class="co">#&gt; 5  AMZN.Close 0.542408713 No Predict</span></span>
<span><span class="co">#&gt; 6  TSLA.Close 0.086492404    Predict</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">bp_all_Loop_1</span><span class="op">)</span></span>
<span><span class="co">#&gt;          Ticker      p-value       pred</span></span>
<span><span class="co">#&gt; 95    TXN.Close 0.0002357208    Predict</span></span>
<span><span class="co">#&gt; 96    CRM.Close 0.8711756478 No Predict</span></span>
<span><span class="co">#&gt; 97    BMY.Close 0.1610277136 No Predict</span></span>
<span><span class="co">#&gt; 98    UPS.Close 0.9590241181 No Predict</span></span>
<span><span class="co">#&gt; 99  RLLCF.Close 0.8083656314 No Predict</span></span>
<span><span class="co">#&gt; 100  QCOM.Close 0.0539758548    Predict</span></span></code></pre></div>
<p>Finally, we could filter to get only those tickers with category predict.</p>
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp_all_Loop_f</span><span class="op">&lt;-</span> <span class="va">bp_all_Loop_1</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pred</span> <span class="op">==</span> <span class="st">"Predict"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">bp_all_Loop_f</span><span class="op">)</span></span>
<span><span class="co">#&gt;        Ticker      p-value    pred</span></span>
<span><span class="co">#&gt; 1  AAPL.Close 1.344870e-03 Predict</span></span>
<span><span class="co">#&gt; 2  MSFT.Close 2.359318e-03 Predict</span></span>
<span><span class="co">#&gt; 3  GOOG.Close 7.415325e-03 Predict</span></span>
<span><span class="co">#&gt; 4 GOOGL.Close 9.713821e-03 Predict</span></span>
<span><span class="co">#&gt; 5  TSLA.Close 8.649240e-02 Predict</span></span>
<span><span class="co">#&gt; 6 BRK.A.Close 3.950538e-06 Predict</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">bp_all_Loop_f</span><span class="op">)</span>  </span>
<span><span class="co">#&gt;        Ticker      p-value    pred</span></span>
<span><span class="co">#&gt; 71  WFC.Close 6.487655e-07 Predict</span></span>
<span><span class="co">#&gt; 72 C.PJ.Close 3.292293e-07 Predict</span></span>
<span><span class="co">#&gt; 73   PM.Close 2.047688e-07 Predict</span></span>
<span><span class="co">#&gt; 74  LIN.Close 3.799114e-02 Predict</span></span>
<span><span class="co">#&gt; 75  TXN.Close 2.357208e-04 Predict</span></span>
<span><span class="co">#&gt; 76 QCOM.Close 5.397585e-02 Predict</span></span></code></pre></div>
<p>Also we take the historical information of the filtered stocks</p>
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ticker</span><span class="op">&lt;-</span><span class="va">bp_all_Loop_f</span><span class="op">[</span>,<span class="st">"Ticker"</span><span class="op">]</span></span>
<span><span class="va">emh</span><span class="op">&lt;-</span><span class="va">return_all_xts</span><span class="op">[</span>,<span class="va">ticker</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">emh</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;              AAPL.Close   MSFT.Close    GOOG.Close  GOOGL.Close</span></span>
<span><span class="co">#&gt; 2020-01-02           NA           NA            NA           NA</span></span>
<span><span class="co">#&gt; 2020-01-03 -0.009722044 -0.012451750 -0.0049072022 -0.005231342</span></span>
<span><span class="co">#&gt; 2020-01-06  0.007968248  0.002584819  0.0246570974  0.026654062</span></span>
<span><span class="co">#&gt; 2020-01-07 -0.004703042 -0.009117758 -0.0006240057 -0.001931646</span></span>
<span><span class="co">#&gt; 2020-01-08  0.016086289  0.015928379  0.0078803309  0.007117757</span></span>
<span><span class="co">#&gt; 2020-01-09  0.021240806  0.012492973  0.0110444988  0.010497921</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">emh</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;              AAPL.Close   MSFT.Close    GOOG.Close  GOOGL.Close</span></span>
<span><span class="co">#&gt; 2022-05-19 -0.024641392 -0.003699634 -0.0147285646 -0.013543429</span></span>
<span><span class="co">#&gt; 2022-05-20  0.001747288 -0.002291226 -0.0129350191 -0.013371513</span></span>
<span><span class="co">#&gt; 2022-05-23  0.040119232  0.032031977  0.0215299497  0.023689766</span></span>
<span><span class="co">#&gt; 2022-05-24 -0.019215988 -0.003951656 -0.0514075636 -0.049494164</span></span>
<span><span class="co">#&gt; 2022-05-25  0.001139947  0.011170149 -0.0008165988 -0.001556952</span></span>
<span><span class="co">#&gt; 2022-05-26  0.023199508  0.012875229  0.0232096155  0.018784556</span></span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="credit-analysis.html"><span class="header-section-number">6</span> Credit analysis</a></div>
<div class="next"><a href="applied-market-anomalies.-momentum-market-anomalies.html"><span class="header-section-number">8</span> Applied market anomalies. Momentum market anomalies</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#rational-agent-and-behavioral-finance-in-investment"><span class="header-section-number">7</span> Rational agent and behavioral finance in investment</a></li>
<li><a class="nav-link" href="#emh-test-on-historical-returns-for-one-asset"><span class="header-section-number">7.1</span> EMH test on historical returns for one asset</a></li>
<li><a class="nav-link" href="#emh-test-for-variance-for-one-asset"><span class="header-section-number">7.2</span> EMH test for variance for one asset</a></li>
<li><a class="nav-link" href="#emh-tests-for-the-variance-for-many-assets-to-build-a-portfolio"><span class="header-section-number">7.3</span> EMH tests for the variance for many assets to build a portfolio</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/abernal30/BookAFP/blob/master/07-Rational-agent-theory.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/abernal30/BookAFP/edit/master/07-Rational-agent-theory.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Algorithms and Financial Programming in R</strong>" was written by Arturo Bernal. It was last built on 2022-11-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
